
%\makeatletter
%\define@lingcmdkeys{secfil}
%\outer\def\section #1\par{%
%   \global\advance\secno by 1  \global\subsecno=0
%      \global\subsubsecno=0
%   \vskip0pt plus \lingsecfil\penalty-20
%   \vskip0pt plus \lingsecfil\bigskip\vskip\parskip
%   {\noindent \titlefont{sec}
%       \the\secno.\enskip #1\par}\nobreak
%   \ifgathercontents \edef\temp{{\the\secno}}%
%      \expandafter\writecontents\temp{#1}\sec\fi \nobreak
%   \medskip\nobreak\noindent
%}
\lingset{secfil=.2\vsize}
\resetatcatcode


\definelingstyle{IJAL}{%
   numlabelclash=true,
   labelanchor=numleft,labeloffset=0pt,
   textanchor=normal,textoffset=1.5em,
   preambleanchor=text,preambleoffset=0pt,
   labelformat=(A),
   everylabel=\actualexno,
   appendtopexarg={samplelabel=(\actualexno a)}
   }
\definelingstyle{UBC}{%
   numlabelclash=false,
   textanchor=numleft,textoffset=50pt,
   labelanchor=numleft,labeloffset=25pt,
   everylabel=,
   preambleanchor=text,preambleoffset=0pt,
   appendtopexarg=
}
\definelingstyle{frampton}{%
   numlabelclash=false,
   textanchor=normal,textoffset=1.4em,
   labelanchor=numright,labeloffset=1.4em,
   everylabel=,
   preambleanchor=labelleft,preambleoffset=0pt,
   appendtopexarg=,
}

\centerline{\titlefont{main} User's Manual, Supplement}
\hfil

\noindent This document explains the new features incorporated in
ExPex version 3.4. Most of the features are concerned with
providing greater flexibility in formatting multipart examples
and glosses.  There are also a few macros which make it easier to
annotate glosses with language names, citations, and the like.
Essentially, they collect various extensions to ExPex 3.3 that I
made to help ExPex users who were forced to follow the style of
the particular publication they were submitting to.

\section Tabular format in multiline examples

\parinventory
& \idx{|textanchor|}&  choice\enspace
   (|numleft|, |numright|, or |labelleft|)& |numright|\cr
& \idx{|preambleanchor|}& choice\enspace
   (|numright|, |labelleft|, or |text|)& |numright|\cr
\endparinventory

Some publications specify that the text and label offset are
measured from the left margin.  ExPex 3.3 measures the label
offset from the right edge of the example number and the
textoffset from the right edge of the ``label gutter'' (the slot
which labels are typeset in). ExPex already had a parameter
|labelanchor| (with values |margin|, |numleft|, and |numright|)
which determined how the value of |labeloffset| was used to set
the position of the labels. A parameter has |textanchor| been
introduced, with obvious meaning.  In multipart examples in ExPex
3.3, the position of a preamble in multipart examples was
measured with respect to the right edge of the typeset example
number.  The preamble is the stuff (if any) which appears before
the first labeled part of a multipart example.  ExPex introduces
the parameter |preambleanchor| (with possible values |numright|,
|numleft|, and |text|), with obvious meaning.

For example,
\begingroup
\codedisplay
\lingset{%
   textanchor=numleft,textoffset=50pt,
   labelanchor=numleft,labeloffset=25pt,
   preambleanchor=text,preambleoffset=0pt,
}
\pex[exno=137]
\a first
\a second
\xe

\pex~[labelwidth=2in]
Preamble
\a first
\a[label=bb] second
\xe
|endcodedisplay

\noindent produces

\lingset{%
   textanchor=numleft,textoffset=5em,
   labelanchor=numleft,labeloffset=2.5em,
   preambleanchor=text,preambleoffset=0pt,
}
\pex[exno=137]
\a first
\a second
\xe

\pex~[labelwidth=2in]
Preamble
\a first
\a[label=bb] second
\xe
The position of the labels and text is unaffected by the
width of the typeset example numer, the specified labelwidth, or
the actual label width.
\endgroup

\section IJAL style format of multiline examples

\parinventory
& \idx{|appendtopexarg|}&  token list& |{}|\cr
& \idx{|numlabelclash|}& boolean (|true| or |false|)& |false|\cr
\endparinventory

\noindent The formatting demands of the International Journal of
American Linguistics (IJAL) poses unsurmountable problems for
ExPex 3.3. Examples of the desired style are given below.

\begingroup
\lingset{lingstyle=IJAL}
\pex<nonum>
\a first
\a second
\xe

\pex~[exno=65]
Preamble
\a first
\a second
\xe

\pex~[exno=1026]
Preamble
\a first
\a second
\xe

Clearly, we must set |labelanchor| to |numleft| and |labeloffset|
to |0pt| (or |0in|, or \dots).

The first issue is that the labelwidth depends
on the example number.
ExPex can deal with this by |\pex[samplelabel=(\actualexno
a)]|.  But it is considerably less than elegant to
have to write this in every |\pex| example.  It will not produce
the desired result to put |\lingset{samplelabel=(\actualexno a)}|
at the beginning of the document.  |labelwidth| will be set to
whatever the current width of |(\actualexno a)| is, which is
not likely to be what you want for the entire document even if
|\actualexno| happens to be defined (which is unlikely) at the
point the |\lingset| is executed.  To circumvent the global/local
problem, ExPex now provides the parameter |appendtopexarg|.  Its
value is appended to whatever other arguments are given to
|\pex| and evaluated locally.  So\smallskip

|\lingset{appendtopexarg=(labelwidth=\actualexno a)}|\smallskip
\noindent accomplishes what we
want.

There is another issue.  The example number does not appear in
(\getref{nonum}).  ExPex now provides the boolean (true or false
values only) parameter |numlabelclash|.  If it is set to |true|,
the example number is not typeset in |\pex| examples with no
preamble.

The code used for the IJAL examples above was:
\codedisplay
\definelingstyle{IJAL}{%
   numlabelclash=true,
   labelanchor=numleft,labeloffset=0pt,
   preambleanchor=text,preambleoffset=0pt,
   labelformat=(A),
   everylabel=\actualexno,
   appendtopexarg={samplelabel=(\actualexno a)}
   }

\pex
\a first
\a second
\xe

\pex~[exno=65]
Preamble
\a first
\a second
\xe

\pex~[exno=1026]
Preamble
\a first
\a second
\xe
|endcodedisplay

\endgroup

\section Multiline preambles

Macro: |\multilinepreamble|
\bigskip

\def\\{\noindent$\bullet$\enspace\ignorespaces}

\noindent Preambles were not properly formatted in ExPex 3.3 if they
extended over more than one line.  For example:

\codedisplay
\pex[preambleoffset=1.5ex,preambleanchor=numright]
This paper must be at least 10 pages long,
so it is useful to this end to write long wordy introductions to
all examples.  Please note that the first example comes before
the second example.  It could be done otherwise, but this
convention is adopted for the benefit of the reader.
\a first
\a second
\xe
|endcodedisplay
gives
\framedisplay
\pex[preambleoffset=1.5ex,preambleanchor=numright]
This paper must be at least 10 pages long,
so it is useful to this end to write long wordy introductions to
all examples.  Please note that the first example comes before
the second example.  It could be done otherwise, but this
convention is adopted for the benefit of the reader.
\a first
\a second
\xe
\endframedisplay

The same problem extends to Expex 3.4, except in the case that
|preambleanchor=text| and |preambleoffset=0pt| (and other
accidental situations which turn out to be equivalent).  The use
of |\multilinepreamble| circumvents the problem by putting the
preamble into an appropriate vbox.

\codedisplay
\pex[preambleoffset=0pt,preambleanchor=labelleft]
\multilinepreamble{This paper must be at least 10 pages long,
so it is useful to this end to write long wordy introductions to
all examples.  Please note that the first example comes before
the second example.  It could be done otherwise, but this
convention is adopted for the benefit of the reader.}
\a first
\a second
\xe
|endcodedisplay
produces
\framedisplay
\pex[preambleoffset=0pt,preambleanchor=labelleft]
\multilinepreamble{This paper must be at least 10 pages long,
so it is useful to this end to write long wordy introductions to
all examples.  Please note that the first example comes before
the second example.  It could be done otherwise, but this
convention is adopted for the benefit of the reader.}
\a first
\a second
\xe
\endframedisplay


\endinput



\bullsec |lingstyle=frampton|
\lingset{lingstyle=frampton}


\pex[exno=65,preambleanchor=text,preambleoffset=0pt]
This paper must be at least 10 pages long,
so it is useful to this end to write long wordy introductions to
all examples.  Please note that the first example comes before
the second example.  It could be done otherwise, but this
convention is adopted for the benefit of the reader.
\a first
\a second
\xe

\pex[exno=65,preambleanchor=labelleft,preambleoffset=0pt]
This paper must be at least 10 pages long,
so it is useful to this end to write long wordy introductions to
all examples.  Please note that the first example comes before
the second example.  It could be done otherwise, but this
convention is adopted for the benefit of the reader.
\a first
\a second
\xe

\pex[exno=65,preambleanchor=labelleft,preambleoffset=0pt]
\multilinepreamble{This paper must be at least 10 pages long,
so it is useful to this end to write long wordy introductions to
all examples.  Please note that the first example comes before
the second example.  It could be done otherwise, but this
convention is adopted for the benefit of the reader.}
\a first
\a second
\xe


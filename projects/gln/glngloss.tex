
\makeatletter

\def\doubleslash{//}

\def\gln@begingl{\leavevmode \hangafter=1 \hangindent=1.5em \@getoptionalarg\gln@B}
\def\gln@B{\@ifnextchar\@cs\gln@C\gln@A}
\def\gln@C#1{\gln@A}
\def\gln@A{%
   \ling@usearg
   \lineskip=\lingextraglskip
   \rightskip=\ling@glrightskip
   \gln@a
}
\def\endilg{}
\def\gln@a{\@ifnextchar\endilg\relax\gln@aa}
\def\gln@aa #1 {\gln@b{#1}\gln@a}
\def\gln@b#1{\gln@c#1\@nil}
\def\gln@c #1[#2]#3\@nil{\let\tempa=\empty
   \def\tempa{\\{#1}}%
   \def\afterword{#3}%
   \gln@d #2/\@nil
}
\def\gln@d #1/{\gl@append #1\to\tempa \gln@e}
\def\gln@e{\@ifnextchar\@nil{\gln@printcol\gobble}\gln@d}
\def\gln@endgl{\egroup}
\def\gln@printcol{%
   \vtop{%
      \ling@everyglword
      \gl@loopmoretrue
      \loop\ifgl@loopmore
         \gl@lop\tempa\to\@tempa
         \gl@lop\gln@aboveskiplist\to\@aboveskip
         \gl@lop\gln@everyline\to\@every
         \ifx\@aboveskip\empty \else
            \expandafter\ifdim\@aboveskip=0pt \else
               \vskip\@aboveskip \fi\fi
         \hbox{\@every\strut\@tempa}%
         \ifx\tempa\empty \gl@loopmorefalse \fi
      \repeat
      }%
   \afterword\hskip\lingglspace}
\def\gln@ft #1//{\par\nobreak\vskip\lingaboveglftskip\strut `#1'}
\define@lingkey{glneveryline}{%
   \setlist\gln@everyline{#1}}
\define@lingkey{glnaboveskiplist}{%
   \setlist\gln@aboveskiplist{#1}}


\def\setlist#1#2{\def#1{}\XKV@for@n{#2}\@this{%
   \expandafter\gl@append\@this\to#1}}
\lingset{glneveryline={},glnaboveskiplist={}}

\def\glossline{\@getoptionalarg\glossline@i}
\def\glossline@i{\bgroup\ling@usearg\exdisplay\begingl}
\def\endglossline{\endgl\xe\egroup}

\resetatcatcode

